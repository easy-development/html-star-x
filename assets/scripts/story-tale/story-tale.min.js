var StoryTale={containerObject:{},containerPanels:[],namespace:"storytale",displayEffect:["rotateIn","rotateInDownLeft","rotateInDownRight","rotateInUpLeft","rotateInUpRight"],Init:function(e,t){this.namespace=this.namespace+"-"+parseInt(Math.random()*1e3);this.containerObject=e;this.displayEffect=t;this._handleItemGroups();this.setContainerPanels();this.loadPanels()},_handleItemGroups:function(){this.containerObject.find("[data-story-tale-item-group]").each(function(){var e=jQuery(this).attr("data-story-tale-item-group")!=""?'data-story-tale-quick data-story-tale-container="'+jQuery(this).attr("data-story-tale-item-group")+'"':"data-story-tale-quick data-story-tale-container";var t=jQuery(this).html().trim(),n=t.split(" "),r="";for(var i=0;i<n.length;i++)r+="<span "+e+' style="display:inline-block;">'+n[i]+"</span>"+" ";jQuery(this).html(r)})},setContainerPanels:function(){var e=this;this.containerPanels=this.containerObject.find("[data-story-tale-item], [data-story-tale-container]");this.containerPanels.each(function(){if(typeof jQuery(this).attr("data-story-tale-item")!="undefined"){var e=jQuery(this).html(),t="";for(var n=0;n<e.length;n++)t+='<span style="opacity: 0.0;display: inline-block;">'+(e[n]==" "?"&nbsp;":e[n])+"</span>";jQuery(this).html(t)}else{jQuery(this).css("opacity","0.0")}})},loadPanels:function(){var e=this;jQuery(window).bind("scroll."+this.namespace,function(){e._handleDisplay()});e._handleDisplay()},_handleDisplay:function(){var e=jQuery(window).scrollTop()+window.innerHeight,t=this,n=this.containerPanels.not(".story-tale-served").first();if(n.length==0){jQuery(window).unbind("scroll."+this.namespace);return}if(!n.hasClass("story-tale-served")&&!n.hasClass("story-tale-serving")&&e>=n.offset().top&&e<=n.offset().top+n.height()*.7+window.innerHeight){if(typeof n.attr("data-story-tale-item")=="undefined"){n.addClass("story-tale-serving");var r=n.attr("data-story-tale-container")==""?t.displayEffect:n.attr("data-story-tale-container").split(",");n.css("opacity","1").addClass("animated "+t._getRandomEffect(r));if(n.is("[data-story-tale-quick]")){n.removeClass("story-tale-serving").addClass("story-tale-served");t._handleDisplay()}else{setTimeout(function(){n.removeClass("story-tale-serving").addClass("story-tale-served");t._handleDisplay()},1e3)}return}if(!(n.find("> span").not(".story-tale-served").length>0)){n.addClass("story-tale-served");return}n.addClass("story-tale-serving");n.find("> span").each(function(){var e=n.attr("data-story-tale-item")==""?t.displayEffect:n.attr("data-story-tale-item").split(",");jQuery(this).css("opacity",1).addClass("story-tale-served animated "+t._getRandomEffect(e))}).promise().done(function(){if(n.is("[data-story-tale-quick]")){n.removeClass("story-tale-serving").addClass("story-tale-served");t._handleDisplay()}else{setTimeout(function(){n.removeClass("story-tale-serving").addClass("story-tale-served");t._handleDisplay()},1e3)}})}},_getRandomEffect:function(e){return e instanceof Array?e[Math.floor(Math.random()*e.length)]:e}};